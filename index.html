<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>cards</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="js/script.js" type="text/javascript"></script>
  </head>
  <body>
    <div class="board">
      <div id="console">
        Welcome to Build-a-Beast<br />
      </div>
    </div>

    <script type="text/javascript">

$(document).ready(function(){

//create card library deck
var cardLibraryDeck = new Stack();
cardLibraryDeck.createStack(cardLibrary);

//works
//alert(cardLibraryDeck.cards[3].cardTitle);

//create players
//TODO allow name input, allow multiple players
var playerName = new Player('player name');

//create player(s) starting hand(s) and shuffle
playerName.deck.createStack(starterDeck);
playerName.deck.shuffle();

//create VARS
var currentPlayer;
window.noTail = '';

//create card banks
//TODO base this on number of players

//16 mutation cards
var mutationDeck = new Stack();
mutationDeck.createStack(mutations);
cardMultiplier(mutationDeck, mutationDeck[0], 15);

//16 small victory cards
var smallVictoryDeck = new Stack();
smallVictoryDeck.createStack(smallVictory);
cardMultiplier(smallVictoryDeck, smallVictoryDeck[0], 15);

//8 big victory cards
var bigVictoryDeck = new Stack();
bigVictoryDeck.createStack(bigVictory);
cardMultiplier(bigVictoryDeck, bigVictoryDeck[0], 7);

//upgrade & head cards
var upgradeDeck = new Stack();
upgradeDeck.createStack(upgrades);
upgradeDeck.shuffle();

var headDeck = new Stack();
headDeck.createStack(heads);
headDeck.shuffle();
//TODO end game if these stacks are empty

//set current player
currentPlayer = playerName;

//put 5 cards from library into hand (library hand is buyable)
for (i=0; i < 5; i++){
  var card = cardLibraryDeck.deal();
  $('#console').append('<p>Library adds '+card.cardTitle+' for '+card.cost+' power.</p>');
  cardLibraryDeck.drawCard(card);
}
//works
//alert(cardLibraryDeck.hand[2].cardTitle);

//START TURN 

//PLAY
//play cards while no tails
do {
  if (currentPlayer.deck.cards.length > 0){
    //deal from player cards(deck) to player's game board
    currentPlayer.deck.playCard(currentPlayer.deck.deal(), currentPlayer);
  } else {
    //put discard into cards and then shuffle
    currentPlayer.deck.cards = currentPlayer.deck.discardPile.splice(0,currentPlayer.deck.discardPile.length);
    currentPlayer.deck.shuffle();
    $('#console').append('<p>Shuffling...</p>');
    //and then deal
    currentPlayer.deck.playCard(currentPlayer.deck.deal(), currentPlayer);
  }
} while (window.noTail != 'tail');

//BUY
//tell player totalPower from play round
$('#console').append('<p>You have '+currentPlayer.totalPower+' power to spend.</p>');
//player buys
while (currentPlayer.totalPower >= 2){
  //todo let user select card
  var cardNum = prompt('select a card (#0-4)');
  var card = cardLibraryDeck.hand[cardNum];

  if (card.cost <= currentPlayer.totalPower){
  	//put card in player discard pile
    currentPlayer.deck.discard(cardLibraryDeck.hand.splice(cardNum));
    //- cost of card from player's totalPower bank
    currentPlayer.totalPower -= card.cost;
    //print card title and cost to console
    $("#console").append(
    	"<p>"+card.cardTitle+" bought for "+card.power+". You have "+currentPlayer.totalPower+" left.</p>"
    	);
  } else {
    $("#console").append("<p>You don't have enough power to do that.</p>");
  }
}
//TODO message to tell player buy round is over?

//player upgrades


//END TURN LOOP




//deal from card library and add to player discard
//playerDeck.discard(cardLibraryDeck.deal());
//works
//alert(playerDeck.discardPile[0].cardTitle);
});
    </script>
  </body>
</html>
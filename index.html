<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>cards</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="js/script.js" type="text/javascript"></script>
  </head>
  <body>
    <div class="board">
      <div id="console">
        Welcome to Build-a-Beast<br />
      </div>
    </div>

    <script type="text/javascript">

$(document).ready(function(){

//create card library deck
var cardLibraryDeck = new Stack();
cardLibraryDeck.createStack(cardLibrary);
cardLibraryDeck.shuffle();

//works
//alert(cardLibraryDeck.cards[3].cardTitle);

//create players
//TODO allow name input, allow multiple players
var playerName = new Player('player name');

//create player(s) starting hand(s) and shuffle
playerName.deck.createStack(starterDeck);
playerName.deck.shuffle();

//create VARS
var currentPlayer;
var currentColors;
window.noTail = '';
var topUpgrade;
var topHead;

//create card banks
//TODO base this on number of players

//16 mutation cards
var mutationDeck = new Stack();
mutationDeck.createStack(mutations);
cardMultiplier(mutationDeck, mutationDeck[0], 15);

//16 small victory cards
var smallVictoryDeck = new Stack();
smallVictoryDeck.createStack(smallVictory);
cardMultiplier(smallVictoryDeck, smallVictoryDeck[0], 15);

//8 big victory cards
var bigVictoryDeck = new Stack();
bigVictoryDeck.createStack(bigVictory);
cardMultiplier(bigVictoryDeck, bigVictoryDeck[0], 7);

//upgrade & head cards
var upgradeDeck = new Stack();
upgradeDeck.createStack(upgrades);
upgradeDeck.shuffle();

var headDeck = new Stack();
headDeck.createStack(heads);
headDeck.shuffle();
//TODO end game if these stacks are empty

//top card of each deck into hand (buyable)
var upgradeCard = upgradeDeck.deal();
$('#console').append('<p>upgrade card costs '+upgradeCard.cost.blue+' blue, '+upgradeCard.cost.red+' red, and '+upgradeCard.cost.green+' green.</p>');
var headCard = headDeck.deal();
$('#console').append('<p>head card costs '+headCard.cost.blue+' blue, '+headCard.cost.red+' red, and '+headCard.cost.green+' green.</p>');

//set current player
currentPlayer = playerName;

//put 5 cards from library into hand (buyable)
for (i=0; i < 5; i++){
  var card = cardLibraryDeck.deal();
  $('#console').append('<p>Library adds '+card.cardTitle+' for '+card.cost+' power.</p>');
  cardLibraryDeck.drawCard(card);
}
//works
//alert(cardLibraryDeck.hand[2].cardTitle);

//START TURN 

//PLAY
//play cards while no tails
do {
  if (currentPlayer.deck.cards.length > 0){
    //deal from player cards(deck) to player's game board
    currentPlayer.deck.playCard(currentPlayer.deck.deal(), currentPlayer);
  } else {
    //put discard into cards and then shuffle
    currentPlayer.deck.cards = currentPlayer.deck.discardPile.splice(0,currentPlayer.deck.discardPile.length);
    currentPlayer.deck.shuffle();
    $('#console').append('<p>Shuffling...</p>');
    //and then deal
    currentPlayer.deck.playCard(currentPlayer.deck.deal(), currentPlayer);
  }
} while (window.noTail != 'tail');

//BUY
//tell player totalPower from play round
$('#console').append('<p>You have '+currentPlayer.totalPower+' power to spend.</p>');
//player buys
while (currentPlayer.totalPower >= 2){
  //todo let user select card
  var cardNum = prompt('select a card (#0-4)');
  var card = cardLibraryDeck.hand[cardNum];

  if (card.cost <= currentPlayer.totalPower){
  	//put card in player discard pile
    currentPlayer.deck.discard(cardLibraryDeck.hand.splice(cardNum));
    //- cost of card from player's totalPower bank
    currentPlayer.totalPower -= card.cost;
    //print card title and cost to console
    $("#console").append(
    	"<p>"+card.cardTitle+" bought for "+card.power+". You have "+currentPlayer.totalPower+" left.</p>"
    	);
  } else {
    $("#console").append("<p>You don't have enough power to do that.</p>");
  }
}
//score turn, end buy, tally colors into an object
currentColors = currentPlayer.scoreTurn();


//UPGRADE / evolve
//check if upgrade and head cards can be bought, start false
var headBuyable = false;
var upgradeBuyable = false;
//check head
if(currentColors.blue >= headCard.cost.blue){
  if(currentColors.red >= headCard.cost.red){
    if(currentColors.green >= headCard.cost.green){
        headBuyable = true;
    }
  }
} 
//check upgrade
if(currentColors.blue >= upgradeCard.cost.blue){
  if(currentColors.red >= upgradeCard.cost.red){
    if(currentColors.green >= upgradeCard.cost.green){
        upgradeBuyable = true;
    }
  }
} 
//if you can afford it, buy a card
if(upgradeBuyable == true && headBuyable == true){
  var choice = prompt('You can evolve! Type "1" to get the upgrade card '+upgradeCard.cardTitle+' or "2" to get the head card '+headCard.cardTitle);
  if(choice == 1){
    $('#console').append('<p>You bought '+upgradeCard.cardTitle+'</p>');
    currentPlayer.deck.addCard(upgradeCard, 'upgrades');
    return;
  } else if(choice == 2){
    $('#console').append('<p>You bought '+headCard.cardTitle+'</p>')
    currentPlayer.deck.addCard(headCard, 'heads');
    return;
  }else{
    $('#console').append('<p>What are you ... I dont even ...</p>')
  }
} else {
  if(headBuyable == true){
    $('#console').append('<p>You bought '+headCard.cardTitle+'</p>');
    //send card to stack.head
    currentPlayer.deck.addCard(headCard, 'heads');
    return;
  }
  if(upgradeBuyable == true){
    $('#console').append('<p>You bought '+upgradeCard.cardTitle+'</p>');
    //send card to stack.upgrades
    currentPlayer.deck.addCard(upgradeCard, 'upgrades');
    return;
  }
  $('#console').append('<p>nothing to evolve this round.</p>');
}



//END TURN LOOP


//END GAME

//deal from card library and add to player discard
//playerDeck.discard(cardLibraryDeck.deal());
//works
//alert(playerDeck.discardPile[0].cardTitle);
});
    </script>
  </body>
</html>